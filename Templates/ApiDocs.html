<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PKHeX WebSocket API Documentation</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; line-height: 1.6; background: #f5f5f5; }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; border-left: 4px solid #3498db; padding-left: 15px; }
        h3 { color: #7f8c8d; }
        .endpoint { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        code { background: #ecf0f1; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; }
        pre { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .badge { background: #3498db; color: white; padding: 3px 8px; border-radius: 3px; font-size: 12px; font-weight: bold; }
        .note { background: #fff3cd; border-left: 4px solid #ffc107; padding: 10px 15px; margin: 10px 0; }
        .connection-info { background: #d4edda; border-left: 4px solid #28a745; padding: 15px; margin: 20px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üéÆ PKHeX WebSocket API Documentation</h1>
    
    <div class="connection-info">
        <h3>WebSocket Connection</h3>
        <p><strong>Endpoint:</strong> <code>ws://your-server:8080/</code> or <code>wss://your-server/</code></p>
        <p><strong>Protocol:</strong> Send and receive JSON messages</p>
        <p><strong>Schema:</strong> Send OPTIONS request to <code>/</code> for machine-readable JSON schema</p>
    </div>

    <h2>Session Management</h2>
    <p>The server supports managing multiple save files concurrently through session IDs:</p>
    <ul>
        <li>When you <code>loadSave</code>, the server generates a unique GUID session ID and returns it</li>
        <li>All subsequent operations <strong>require</strong> this <code>sessionId</code> parameter</li>
        <li>Multiple clients can work with different saves simultaneously without interference</li>
        <li>Thread-safe operations using ConcurrentDictionary</li>
    </ul>
    <div class="note">
        <strong>Important:</strong> Session IDs are auto-generated by the server to prevent accidental save file conflicts between concurrent users.
    </div>

    <h2>API Actions</h2>

    <div class="endpoint">
        <h3><span class="badge">SAVE</span> loadSave</h3>
        <p>Load a Pok√©mon save file from base64-encoded data. The server generates and returns a unique session ID.</p>
        <pre>{
  "action": "loadSave",
  "data": "&lt;base64-encoded save file&gt;"
}</pre>
        <p><strong>Returns:</strong> Save info including <strong>sessionId</strong> (GUID), game version, trainer name, box count</p>
        <div class="note">
            <strong>Important:</strong> Save the returned <code>sessionId</code> - you'll need it for all subsequent operations!
        </div>
    </div>

    <div class="endpoint">
        <h3><span class="badge">SAVE</span> saveSave</h3>
        <p>Export the current save file as base64-encoded data.</p>
        <pre>{
  "action": "saveSave",
  "sessionId": "your-session-id-here"
}</pre>
        <p><strong>Returns:</strong> <code>{ success: true, data: "&lt;base64&gt;" }</code></p>
    </div>

    <div class="endpoint">
        <h3><span class="badge">SAVE</span> getSaveInfo</h3>
        <p>Get general information about the loaded save file.</p>
        <pre>{
  "action": "getSaveInfo",
  "sessionId": "your-session-id-here"
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">SAVE</span> listSessions</h3>
        <p>List all currently active session IDs.</p>
        <pre>{
  "action": "listSessions"
}</pre>
        <p><strong>Returns:</strong> <code>{ sessionIds: ["guid-1", "guid-2"], count: 2 }</code></p>
    </div>

    <div class="endpoint">
        <h3><span class="badge">SAVE</span> unloadSession</h3>
        <p>Remove a session and its save file from memory.</p>
        <pre>{
  "action": "unloadSession",
  "sessionId": "your-session-id-here"
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">READ</span> getPokemon</h3>
        <p>Get detailed information about a specific Pok√©mon.</p>
        <pre>{
  "action": "getPokemon",
  "box": 0,
  "slot": 0,
  "sessionId": "your-session-id-here"
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">READ</span> getAllPokemon</h3>
        <p>Get a list of all non-empty Pok√©mon in boxes.</p>
        <pre>{
  "action": "getAllPokemon",
  "sessionId": "your-session-id-here"
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">READ</span> checkLegality</h3>
        <p>Check if a Pok√©mon is legal/legitimate.</p>
        <pre>{
  "action": "checkLegality",
  "box": 0,
  "slot": 0,
  "sessionId": "your-session-id-here"
}</pre>
        <p><strong>Returns:</strong> <code>valid</code>, <code>parsed</code>, <code>report</code>, <code>encounterType</code>, <code>encounterMatch</code></p>
    </div>

    <div class="endpoint">
        <h3><span class="badge">READ</span> exportShowdown</h3>
        <p>Export a Pok√©mon in Showdown format.</p>
        <pre>{
  "action": "exportShowdown",
  "box": 0,
  "slot": 0,
  "sessionId": "your-session-id-here"
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">WRITE</span> setPokemon</h3>
        <p>Replace a Pok√©mon with binary data.</p>
        <pre>{
  "action": "setPokemon",
  "box": 0,
  "slot": 0,
  "data": "&lt;base64-encoded pokemon data&gt;",
  "sessionId": "your-session-id-here"
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">WRITE</span> modifyPokemon</h3>
        <p>Modify specific Pok√©mon properties.</p>
        <pre>{
  "action": "modifyPokemon",
  "sessionId": "your-session-id-here",
  "box": 0,
  "slot": 0,
  "modifications": {
    "species": 25,           // Pikachu
    "nickname": "Sparky",
    "level": 50,
    "nature": 12,
    "ability": 9,
    "heldItem": 1,
    "gender": 0,
    "shiny": true,
    "moves": [85, 86, 87, 88],
    "ivs": { "hp": 31, "attack": 31, "defense": 31, "spAttack": 31, "spDefense": 31, "speed": 31 },
    "evs": { "hp": 0, "attack": 252, "defense": 0, "spAttack": 0, "spDefense": 4, "speed": 252 }
  }
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">WRITE</span> deletePokemon</h3>
        <p>Clear a box slot.</p>
        <pre>{
  "action": "deletePokemon",
  "box": 0,
  "slot": 0,
  "sessionId": "your-session-id-here"
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">WRITE</span> movePokemon</h3>
        <p>Move or swap Pok√©mon between slots.</p>
        <pre>{
  "action": "movePokemon",
  "fromBox": 0,
  "fromSlot": 0,
  "toBox": 0,
  "toSlot": 1,
  "sessionId": "your-session-id-here"
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">WRITE</span> importShowdown</h3>
        <p>Import a Pok√©mon from Showdown format.</p>
        <pre>{
  "action": "importShowdown",
  "box": 0,
  "slot": 0,
  "showdown": "Pikachu @ Light Ball\nAbility: Static\nEVs: 252 SpA / 252 Spe\n- Thunderbolt",
  "sessionId": "your-session-id-here"
}</pre>
        <div class="note">
            <strong>Note:</strong> Manual legality check recommended after import
        </div>
    </div>

    <div class="endpoint">
        <h3><span class="badge">WRITE</span> legalizePokemon</h3>
        <p>Apply basic normalization to a Pok√©mon (heal HP/PP, refresh checksum).</p>
        <pre>{
  "action": "legalizePokemon",
  "box": 0,
  "slot": 0,
  "sessionId": "your-session-id-here"
}</pre>
        <div class="note">
            <strong>Note:</strong> This only heals HP/PP and refreshes the checksum. It does NOT automatically fix legality issues. Use <code>checkLegality</code> to verify and <code>modifyPokemon</code> to manually correct issues.
        </div>
    </div>

    <h2>Trainer Operations</h2>

    <div class="endpoint">
        <h3><span class="badge">READ</span> getTrainerInfo</h3>
        <p>Get trainer information including name, IDs, gender, money, play time, and language.</p>
        <pre>{
  "action": "getTrainerInfo",
  "sessionId": "your-session-id-here"
}</pre>
        <p><strong>Returns:</strong> Trainer name, IDs (TID/SID), gender, money, play time, language</p>
    </div>

    <div class="endpoint">
        <h3><span class="badge">WRITE</span> setTrainerInfo</h3>
        <p>Modify trainer information.</p>
        <pre>{
  "action": "setTrainerInfo",
  "sessionId": "your-session-id-here",
  "trainer": {
    "trainerName": "Ash",
    "trainerID": 12345,
    "secretID": 67890,
    "gender": 0,
    "money": 999999
  }
}</pre>
    </div>

    <h2>Party Pok√©mon Operations</h2>

    <div class="endpoint">
        <h3><span class="badge">READ</span> getParty</h3>
        <p>Get all Pok√©mon in the party with basic info (species, nickname, level, HP).</p>
        <pre>{
  "action": "getParty",
  "sessionId": "your-session-id-here"
}</pre>
        <p><strong>Returns:</strong> Array of party Pok√©mon with slot numbers and party count</p>
    </div>

    <div class="endpoint">
        <h3><span class="badge">READ</span> getPartySlot</h3>
        <p>Get detailed information about a specific party slot (0-5).</p>
        <pre>{
  "action": "getPartySlot",
  "slot": 0,
  "sessionId": "your-session-id-here"
}</pre>
        <p><strong>Returns:</strong> Full Pok√©mon details (stats, IVs, EVs, moves, OT info, etc.)</p>
    </div>

    <div class="endpoint">
        <h3><span class="badge">WRITE</span> setPartySlot</h3>
        <p>Replace a Pok√©mon in a party slot with binary data.</p>
        <pre>{
  "action": "setPartySlot",
  "slot": 0,
  "data": "&lt;base64-encoded pokemon data&gt;",
  "sessionId": "your-session-id-here"
}</pre>
    </div>

    <div class="endpoint">
        <h3><span class="badge">WRITE</span> deletePartySlot</h3>
        <p>Remove a Pok√©mon from the party (shifts remaining Pok√©mon up).</p>
        <pre>{
  "action": "deletePartySlot",
  "slot": 0,
  "sessionId": "your-session-id-here"
}</pre>
        <div class="note">
            <strong>Note:</strong> Deleting a party slot automatically decreases party count and shifts remaining Pok√©mon
        </div>
    </div>

    <div class="endpoint">
        <h3><span class="badge">READ</span> getBoxNames</h3>
        <p>Get all box names.</p>
        <pre>{
  "action": "getBoxNames",
  "sessionId": "your-session-id-here"
}</pre>
        <div class="note">
            <strong>Note:</strong> Returns placeholder names in current version
        </div>
    </div>

    <h2>Error Responses</h2>
    <p>All actions may return error responses in the format:</p>
    <pre>{
  "error": "Description of what went wrong"
}</pre>

    <h2>Technology</h2>
    <ul>
        <li><strong>Framework:</strong> ASP.NET Core (.NET 9.0)</li>
        <li><strong>PKHeX Version:</strong> PKHeX.Core 25.9.25</li>
        <li><strong>Protocol:</strong> WebSocket with JSON messaging</li>
        <li><strong>Concurrency:</strong> Thread-safe multi-save support</li>
    </ul>
</body>
</html>
